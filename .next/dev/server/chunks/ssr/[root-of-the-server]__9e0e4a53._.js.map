{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 10, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ROG/Desktop/sas/sas-web/pages/index.js"],"sourcesContent":["import { useEffect, useMemo, useState } from \"react\";\r\nimport Head from \"next/head\";\r\n\r\nconst OPTIONS = [\r\n  { v: 1, t: \"很少或没有\" },\r\n  { v: 2, t: \"有时\" },\r\n  { v: 3, t: \"经常\" },\r\n  { v: 4, t: \"几乎总是\" },\r\n];\r\n\r\nexport default function Home() {\r\n  const [questions, setQuestions] = useState([]);\r\n  const [answers, setAnswers] = useState({}); // key 一律 String(id)\r\n  const [loading, setLoading] = useState(true);\r\n  const [submitting, setSubmitting] = useState(false);\r\n\r\n  const [phone, setPhone] = useState(\"\");\r\n  const [name, setName] = useState(\"\");\r\n  const [sex, setSex] = useState(\"\");\r\n  const [age, setAge] = useState(\"\");\r\n\r\n  // 拉题库\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const res = await fetch(\"/api/sas_questions\");\r\n        const text = await res.text();\r\n        let data = {};\r\n        try { data = JSON.parse(text); } catch {}\r\n\r\n        if (!res.ok) throw new Error(`sas_questions ${res.status}: ${text.slice(0, 300)}`);\r\n\r\n        setQuestions(Array.isArray(data?.questions) ? data.questions : []);\r\n      } catch (e) {\r\n        console.error(e);\r\n        alert(`题目加载失败：${e.message}`);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n  }, []);\r\n\r\n  // 完成度 & 临时分数（最终分数以后端为准）\r\n  const { rawScore, standardScore, finishedCount, allDone } = useMemo(() => {\r\n    const ids = questions.map((q) => q.id);\r\n    let sum = 0;\r\n    let cnt = 0;\r\n\r\n    for (const id of ids) {\r\n      const key = String(id);\r\n      const val = answers[key];\r\n      if (val != null) {\r\n        sum += Number(val);\r\n        cnt += 1;\r\n      }\r\n    }\r\n\r\n    return {\r\n      rawScore: sum,\r\n      standardScore: Math.round(sum * 1.25),\r\n      finishedCount: cnt,\r\n      allDone: ids.length > 0 && cnt === ids.length,\r\n    };\r\n  }, [answers, questions]);\r\n\r\n  function onPick(qid, val) {\r\n    const key = String(qid);\r\n    setAnswers((prev) => ({ ...prev, [key]: val }));\r\n  }\r\n\r\n  async function onSubmit() {\r\n    if (!allDone) return alert(\"请先完成所有题目\");\r\n    if (!phone.trim()) return alert(\"请填写手机号（必填，用于识别同一用户）\");\r\n\r\n    setSubmitting(true);\r\n    try {\r\n      // 转成 {1: v, 2: v...}\r\n      const answersForServer = {};\r\n      for (const q of questions) {\r\n        answersForServer[q.id] = answers[String(q.id)];\r\n      }\r\n\r\n      const payload = {\r\n        name: name.trim() || null,\r\n        sex: sex || null,\r\n        age: age ? Number(age) : null,\r\n        phone: phone.trim(),\r\n        answers: answersForServer,\r\n      };\r\n\r\n      const res = await fetch(\"/api/sas_submit\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify(payload),\r\n      });\r\n\r\n      const text = await res.text();\r\n      let data = {};\r\n      try { data = JSON.parse(text); } catch {}\r\n\r\n      if (!res.ok) throw new Error(data?.error || `sas_submit ${res.status}: ${text.slice(0, 300)}`);\r\n\r\n      const id = data?.id ?? data?.assessmentId;\r\n      if (!id) throw new Error(\"后端未返回 id\");\r\n\r\n      window.location.href = `/result?id=${encodeURIComponent(id)}`;\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`提交失败：${e.message}`);\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <Head>\r\n        <title>SAS 焦虑自评量表</title>\r\n        <link rel=\"stylesheet\" href=\"/css/style.css\" />\r\n      </Head>\r\n\r\n      <div className=\"container\">\r\n        <div className=\"card\">\r\n          <div className=\"h1\">SAS 焦虑自评量表</div>\r\n          <p className=\"p\">请根据最近一周的真实感受作答。完成后自动计算原始分与标准分。</p>\r\n\r\n          <div className=\"row\">\r\n            <span className=\"badge\">已完成 {finishedCount}/{questions.length || 20}</span>\r\n            <span className=\"badge\">原始分：{rawScore}</span>\r\n            <span className=\"badge\">标准分：{standardScore}</span>\r\n          </div>\r\n\r\n          <div style={{ marginTop: 14 }}>\r\n            <div className=\"qtitle\">基本信息</div>\r\n\r\n            <div className=\"row\" style={{ alignItems: \"stretch\" }}>\r\n              <div style={{ flex: 1, minWidth: 200 }}>\r\n                <input className=\"input\" placeholder=\"姓名（可选）\" value={name}\r\n                  onChange={(e) => setName(e.target.value)} />\r\n              </div>\r\n              <div style={{ flex: 1, minWidth: 200 }}>\r\n                <input className=\"input\" placeholder=\"手机号（必填，用于识别同一用户）\" value={phone}\r\n                  onChange={(e) => setPhone(e.target.value)} />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"row\" style={{ alignItems: \"stretch\" }}>\r\n              <div style={{ flex: 1, minWidth: 200 }}>\r\n                <input className=\"input\" placeholder=\"性别（可选，如：女/男）\" value={sex}\r\n                  onChange={(e) => setSex(e.target.value)} />\r\n              </div>\r\n              <div style={{ flex: 1, minWidth: 200 }}>\r\n                <input className=\"input\" placeholder=\"年龄（可选）\" value={age}\r\n                  onChange={(e) => setAge(e.target.value)} />\r\n              </div>\r\n            </div>\r\n          </div>\r\n\r\n          <div style={{ marginTop: 10 }}>\r\n            {loading ? (\r\n              <p className=\"p\">题目加载中…</p>\r\n            ) : questions.length === 0 ? (\r\n              <p className=\"p\">没有题目数据。请检查 /api/sas_questions 输出。</p>\r\n            ) : (\r\n              questions.map((q) => {\r\n                const key = String(q.id);\r\n                return (\r\n                  <div className=\"q\" key={q.id}>\r\n                    <div className=\"qtitle\">\r\n                      {q.id}. {q.text}\r\n                      {q.reverse ? <span className=\"badge\" style={{ marginLeft: 8 }}>反向计分</span> : null}\r\n                    </div>\r\n\r\n                    <div className=\"options\">\r\n                      {OPTIONS.map((op) => (\r\n                        <label key={op.v} className={`opt ${answers[key] === op.v ? \"optSelected\" : \"\"}`}>\r\n                          <input\r\n                            type=\"radio\"\r\n                            name={`q_${q.id}`}\r\n                            value={op.v}\r\n                            checked={answers[key] === op.v}\r\n                            onChange={() => onPick(q.id, op.v)}\r\n                          />\r\n                          <span>{op.v} - {op.t}</span>\r\n                        </label>\r\n                      ))}\r\n                    </div>\r\n                  </div>\r\n                );\r\n              })\r\n            )}\r\n          </div>\r\n\r\n          <div className=\"row\">\r\n            <button className=\"btn\" onClick={onSubmit} disabled={!allDone || submitting}>\r\n              {submitting ? \"提交中…\" : \"提交并查看结果\"}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}