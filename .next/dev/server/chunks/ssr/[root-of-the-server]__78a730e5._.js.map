{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ROG/Desktop/sas/sas-web/pages/result.js"],"sourcesContent":["import { useEffect, useMemo, useState } from \"react\";\r\nimport { useRouter } from \"next/router\";\r\n\r\nfunction pickSingle(v) {\r\n  return Array.isArray(v) ? v[0] : v;\r\n}\r\n\r\nfunction levelText(level) {\r\n  if (!level) return \"\";\r\n  const s = String(level);\r\n  // 兼容：轻度焦虑 / 中度焦虑 / 重度焦虑 / 轻度 / 中度 / 重度\r\n  if (s.includes(\"轻\")) return \"轻度\";\r\n  if (s.includes(\"中\")) return \"中度\";\r\n  if (s.includes(\"重\")) return \"重度\";\r\n  return s;\r\n}\r\n\r\nfunction levelIndex(level) {\r\n  const t = levelText(level);\r\n  if (t === \"轻度\") return 0;\r\n  if (t === \"中度\") return 1;\r\n  if (t === \"重度\") return 2;\r\n  return 0;\r\n}\r\n\r\nfunction adviceByLevel(level) {\r\n  const t = levelText(level);\r\n\r\n  if (t === \"重度\") {\r\n    return {\r\n      title: \"建议（重度：优先级最高）\",\r\n      bullets: [\r\n        \"建议尽快（48小时内）寻求专业帮助（家庭医生/精神心理专科/心理服务）。\",\r\n        \"等待就医期间：减少独处，让可信任的人知晓并陪伴；规律进食与睡眠。\",\r\n        \"若出现强烈绝望感/冲动行为/严重胸痛或呼吸困难等，请立即急诊/急救。\",\r\n      ],\r\n    };\r\n  }\r\n\r\n  if (t === \"中度\") {\r\n    return {\r\n      title: \"建议（中度：建议尽快获得支持）\",\r\n      bullets: [\r\n        \"优先稳住最影响生活的1–2个症状：睡眠、心悸、反复担心、惊恐等。\",\r\n        \"连续2周：每天固定“放松训练 + 轻运动”。\",\r\n        \"建议1周内联系专业支持（家庭医生/心理咨询）做进一步评估与干预（如CBT等）。\",\r\n        \"减少刺激源：咖啡因、熬夜、酒精、过度信息摄入。\",\r\n      ],\r\n    };\r\n  }\r\n\r\n  // 默认轻度（或正常也给轻度建议）\r\n  return {\r\n    title: \"建议（轻度：7天行动版）\",\r\n    bullets: [\r\n      \"每天10–15分钟：腹式呼吸/渐进性肌肉放松（PMR）或拉伸。\",\r\n      \"每周≥3次：快走/骑行/瑜伽等20–30分钟。\",\r\n      \"睡前1小时减少刷手机、咖啡因、酒精；尽量固定入睡时间。\",\r\n      \"用1分钟记录：触发点—想法—感受—应对（找出最常见诱因）。\",\r\n      \"建议1–2周后复测，观察变化。\",\r\n    ],\r\n  };\r\n}\r\n\r\nconst DISCLAIMER =\r\n  \"重要提示：本测评为焦虑自评量表（SAS），用于了解最近一周焦虑症状水平变化，适合初步筛查与自我监测；结果受主观感受等影响，不能替代医学诊断或用药依据。如症状持续、加重或已影响睡眠/工作学习/日常生活，建议寻求专业医疗或心理支持。\";\r\n\r\nexport default function ResultPage() {\r\n  const router = useRouter();\r\n\r\n  // ✅ 关键：等 router.isReady 再读取 query，避免 hydration mismatch\r\n  const id = useMemo(() => {\r\n    if (!router.isReady) return null;\r\n    const v = pickSingle(router.query?.id);\r\n    return v ? String(v).trim() : null;\r\n  }, [router.isReady, router.query]);\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [err, setErr] = useState(\"\");\r\n  const [data, setData] = useState(null);\r\n\r\n  useEffect(() => {\r\n    if (!router.isReady) return;\r\n    if (!id) return;\r\n\r\n    let cancelled = false;\r\n\r\n    (async () => {\r\n      try {\r\n        setErr(\"\");\r\n        setLoading(true);\r\n        setData(null);\r\n\r\n        // ✅ 相对路径：会自动跟随当前端口（3000/3001）\r\n        const r = await fetch(`/api/sas_result?id=${encodeURIComponent(id)}`);\r\n        const j = await r.json().catch(() => ({}));\r\n\r\n        if (!r.ok) {\r\n          throw new Error(j?.error || \"获取结果失败\");\r\n        }\r\n\r\n        if (!cancelled) setData(j);\r\n      } catch (e) {\r\n        if (!cancelled) setErr(String(e.message || e));\r\n      } finally {\r\n        if (!cancelled) setLoading(false);\r\n      }\r\n    })();\r\n\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n  }, [router.isReady, id]);\r\n\r\n  // ✅ SSR 首屏固定输出：避免 hydration 错\r\n  if (!router.isReady) {\r\n    return (\r\n      <div className=\"container\">\r\n        <div className=\"card\">\r\n          <div className=\"h1\">测评结果</div>\r\n          <p className=\"p\">加载中…</p>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (!id) {\r\n    return (\r\n      <div className=\"container\">\r\n        <div className=\"card\">\r\n          <div className=\"h1\">测评结果</div>\r\n          <p className=\"p\">缺少结果 id（请从提交完成后自动跳转进入）</p>\r\n          <div className=\"row\" style={{ marginTop: 14 }}>\r\n            <button className=\"btn\" onClick={() => router.push(\"/\")}>\r\n              返回量表\r\n            </button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // ✅ 兼容你现在 API：data.score.raw / standard / level\r\n  const score = data?.score || null;\r\n  const raw = score?.raw ?? \"-\";\r\n  const standard = score?.standard ?? \"-\";\r\n  const level = score?.level ?? \"\";\r\n  const idx = levelIndex(level);\r\n  const adv = adviceByLevel(level);\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"card\">\r\n        <div className=\"h1\">测评结果</div>\r\n\r\n        <div className=\"row\" style={{ marginTop: 10 }}>\r\n          <span className=\"badge\">评估ID：{id}</span>\r\n          <span className=\"badge\">原始分：{raw}</span>\r\n          <span className=\"badge\">标准分：{standard}</span>\r\n        </div>\r\n\r\n        <div style={{ marginTop: 16 }}>\r\n          <div className=\"qtitle\">焦虑分级</div>\r\n\r\n          {/* 绿色分级条（需要你 style.css 里有 levelBar/levelSeg/active） */}\r\n          <div className=\"levelBar\" style={{ marginTop: 8 }}>\r\n            {[\"轻度\", \"中度\", \"重度\"].map((t, i) => (\r\n              <div key={t} className={\"levelSeg \" + (i === idx ? \"active\" : \"\")}>\r\n                {t}\r\n              </div>\r\n            ))}\r\n          </div>\r\n\r\n          <p className=\"p\" style={{ marginTop: 8 }}>\r\n            当前分级：<b>{level ? String(level) : \"—\"}</b>\r\n          </p>\r\n        </div>\r\n\r\n        {loading && <p className=\"p\">加载中…</p>}\r\n        {err && (\r\n          <p className=\"p\" style={{ color: \"crimson\" }}>\r\n            {err}\r\n          </p>\r\n        )}\r\n\r\n        {/* 建议 */}\r\n        <div style={{ marginTop: 16 }}>\r\n          <div className=\"qtitle\">{adv.title}</div>\r\n          <ul className=\"p\" style={{ marginTop: 8, paddingLeft: 18 }}>\r\n            {adv.bullets.map((b) => (\r\n              <li key={b} style={{ marginBottom: 6 }}>\r\n                {b}\r\n              </li>\r\n            ))}\r\n          </ul>\r\n        </div>\r\n\r\n        {/* 免责声明 */}\r\n        <div style={{ marginTop: 16 }}>\r\n          <div className=\"qtitle\">免责声明</div>\r\n          <p className=\"p\" style={{ opacity: 0.85 }}>\r\n            {DISCLAIMER}\r\n          </p>\r\n        </div>\r\n\r\n        <div className=\"row\" style={{ marginTop: 14 }}>\r\n          <button className=\"btn\" onClick={() => router.push(\"/\")}>\r\n            返回量表\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n\r\n"],"names":[],"mappings":"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"}}]
}