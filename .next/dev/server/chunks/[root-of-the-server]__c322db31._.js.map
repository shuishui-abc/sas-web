{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ROG/Desktop/sas/sas-web/lib/db.js"],"sourcesContent":["import mysql from \"mysql2/promise\";\r\n\r\nlet pool;\r\n\r\nexport default function getPool() {\r\n  if (!pool) {\r\n    pool = mysql.createPool({\r\n      host: process.env.MYSQL_HOST || \"127.0.0.1\",\r\n      port: Number(process.env.MYSQL_PORT || 3306),\r\n      user: process.env.MYSQL_USER || \"root\",\r\n      password: process.env.MYSQL_PASSWORD || \"002025\",\r\n      database: process.env.MYSQL_DATABASE || \"sas_app\",\r\n      waitForConnections: true,\r\n      connectionLimit: 10,\r\n      queueLimit: 0,\r\n      timezone: \"Z\",\r\n    });\r\n  }\r\n  return pool;\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,IAAI;AAEW,SAAS;IACtB,IAAI,CAAC,MAAM;QACT,OAAO,mNAAK,CAAC,UAAU,CAAC;YACtB,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;YAChC,MAAM,OAAO,QAAQ,GAAG,CAAC,UAAU,IAAI;YACvC,MAAM,QAAQ,GAAG,CAAC,UAAU,IAAI;YAChC,UAAU,QAAQ,GAAG,CAAC,cAAc,IAAI;YACxC,UAAU,QAAQ,GAAG,CAAC,cAAc,IAAI;YACxC,oBAAoB;YACpB,iBAAiB;YACjB,YAAY;YACZ,UAAU;QACZ;IACF;IACA,OAAO;AACT"}},
    {"offset": {"line": 43, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ROG/Desktop/sas/sas-web/pages/api/sas_result.js"],"sourcesContent":["import getPool from \"../../lib/db.js\";\r\n\r\nfunction json(res, status, data) {\r\n  res.statusCode = status;\r\n  res.setHeader(\"Content-Type\", \"application/json; charset=utf-8\");\r\n  res.setHeader(\"Cache-Control\", \"no-store\");\r\n  res.end(JSON.stringify(data));\r\n}\r\n\r\nfunction pickSingle(v) {\r\n  return Array.isArray(v) ? v[0] : v;\r\n}\r\n\r\nexport default async function handler(req, res) {\r\n  if (req.method !== \"GET\") return json(res, 405, { error: \"Method Not Allowed\" });\r\n\r\n  try {\r\n    const idRaw = pickSingle(req.query?.id);\r\n    const id = idRaw ? String(idRaw).trim() : \"\";\r\n    if (!id) return json(res, 400, { error: \"Missing id\" });\r\n\r\n    const pool = getPool();\r\n    const conn = await pool.getConnection();\r\n\r\n    try {\r\n      const [rows] = await conn.query(\r\n        `\r\n        SELECT\r\n          a.id,\r\n          a.raw_score,\r\n          a.standard_score,\r\n          a.level\r\n        FROM assessments a\r\n        WHERE a.id = ?\r\n        LIMIT 1\r\n        `,\r\n        [id]\r\n      );\r\n\r\n      if (!rows || rows.length === 0) return json(res, 404, { error: \"Not found\" });\r\n\r\n      const r = rows[0];\r\n\r\n      // 给前端统一结构\r\n      return json(res, 200, {\r\n        ok: true,\r\n        assessmentId: r.id,\r\n        score: { raw: r.raw_score, standard: r.standard_score, level: r.level },\r\n      });\r\n    } finally {\r\n      conn.release();\r\n    }\r\n  } catch (e) {\r\n    return json(res, 500, { error: String(e.message || e) });\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,SAAS,KAAK,GAAG,EAAE,MAAM,EAAE,IAAI;IAC7B,IAAI,UAAU,GAAG;IACjB,IAAI,SAAS,CAAC,gBAAgB;IAC9B,IAAI,SAAS,CAAC,iBAAiB;IAC/B,IAAI,GAAG,CAAC,KAAK,SAAS,CAAC;AACzB;AAEA,SAAS,WAAW,CAAC;IACnB,OAAO,MAAM,OAAO,CAAC,KAAK,CAAC,CAAC,EAAE,GAAG;AACnC;AAEe,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,OAAO,OAAO,KAAK,KAAK,KAAK;QAAE,OAAO;IAAqB;IAE9E,IAAI;QACF,MAAM,QAAQ,WAAW,IAAI,KAAK,EAAE;QACpC,MAAM,KAAK,QAAQ,OAAO,OAAO,IAAI,KAAK;QAC1C,IAAI,CAAC,IAAI,OAAO,KAAK,KAAK,KAAK;YAAE,OAAO;QAAa;QAErD,MAAM,OAAO,IAAA,6IAAO;QACpB,MAAM,OAAO,MAAM,KAAK,aAAa;QAErC,IAAI;YACF,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,KAAK,CAC7B,CAAC;;;;;;;;;QASD,CAAC,EACD;gBAAC;aAAG;YAGN,IAAI,CAAC,QAAQ,KAAK,MAAM,KAAK,GAAG,OAAO,KAAK,KAAK,KAAK;gBAAE,OAAO;YAAY;YAE3E,MAAM,IAAI,IAAI,CAAC,EAAE;YAEjB,UAAU;YACV,OAAO,KAAK,KAAK,KAAK;gBACpB,IAAI;gBACJ,cAAc,EAAE,EAAE;gBAClB,OAAO;oBAAE,KAAK,EAAE,SAAS;oBAAE,UAAU,EAAE,cAAc;oBAAE,OAAO,EAAE,KAAK;gBAAC;YACxE;QACF,SAAU;YACR,KAAK,OAAO;QACd;IACF,EAAE,OAAO,GAAG;QACV,OAAO,KAAK,KAAK,KAAK;YAAE,OAAO,OAAO,EAAE,OAAO,IAAI;QAAG;IACxD;AACF"}}]
}